---
title: Как организована веб-платформа
date: 2021-06-18
author: vitaly-zyuzin
editors:
    - vadim-makeev
tags:
    - html
    - css
    - js
preview: Что за веб-платформа, W3C, WHATWG, CSS-спеки, web-platform-tests, и зачем вообще всё это надо.
---

## Веб-платформа

«Веб-платформа» — это набор стандартизированных API (HTML, CSS, JavaScript, SVG…), которые разработчики используют для построения сайтов и веб-приложений. Вдобавок к «корневым» технологиям платформа включает ещё и локальные браузерные API, которые добавляют в браузер новую функциональность: DOM, Console API, Fetch API и другие.

## Стандарты

То, как всё работает в браузере, описано в специальных документах — спецификациях. Это подробные инструкции для разработчиков, как должна работать какая-то определённая фича. Например, как должны строиться флексбокс-лейауты или как должен работать `console.log`.

## Спецификации

Спецификаций в веб-платформе много. Спеки создаются в специальных организациях — органах по стандартизации (standards body): W3C, WHATWG, Ecma International, OpenJS Foundation и другие — в них и создаются HTML, CSS, SVG, JS, Node.js. Дальше подробно расскажу, как работают W3C и WHATWG.

## W3C

World Wide Web Consortium — международная организация, в штате которой примерно 60 человек из мировых университетов (MIT, ERCIM, Keio University, Beihang University). Также в W3C есть членство для внешних компаний.
В апреле 2021 есть 438 компаний-членов: браузеры (Mozilla, Google), софт (Adobe, Zoom), техногиганты (Amazon, Apple, Facebook, Visa, Alibaba), сервисы (Airbnb, Netflix, Shopify), железо (Huawei, Intel) и [другие](https://www.w3.org/Consortium/Member/List).

Чтобы иметь членство W3C, компании нужно платить членские взносы (для бедных стран — меньше, для богатых — больше). Например, если небольшая российская компания захочет вступить в «клуб» W3C, то это в 2021 году будет стоить минимум 1950 EUR в год (для больших компаний ещё x10).

Компании отправляют своих сотрудников для работы в W3C. Вместе со штатными сотрудниками W3C приглашённые делегаты формируют [рабочие группы](https://www.w3.org/groups/wg/) (WG, Working Group).

Работа в FAANG — не единственный способ попасть в рабочую группу W3C. Группа может включать и приглашённых экспертов (Invited Expert), которые никак не аффилированы с бизнесом, но являются крутанами в своей области.
Все рабочие группы собираются на ежегодной сходке TPAC (Technical Plenary), которая проходит осенью.

### Рабочая группа CSS в W3C

Как устроена рабочая группа, на примере [CSS Working Group](https://www.w3.org/groups/wg/css/participants?sortaff=1).

В ней есть председатели, штатные сотрудники W3C, делегаты из внешних компаний (FAANG и компания) и приглашённые эксперты (например, Rachel Andrew, Elika Etemad, Lea Verou, Jonathan Neal…). Внешние эксперты приглашаются по предложению участников рабочей группы.

Среди всех участников выделяется три роли:

- редакторы спецификаций — отвечают за модули спецификаций, следят за ишью, получают фидбек, пишут спеку и тащат прогресс по своим модулям спек (иногда у спеки только один редактор, иногда — несколько);
- остальные члены рабочей группы (нередакторы) — участвуют в дискуссии, брейнштормят, принимают коллективные решения;
- сообщество сочувствующих [www-style](https://lists.w3.org/Archives/Public/www-style/) — это как непосредственно участники группы, так и в целом все заинтересованные в CSS люди: они комментируют и критикуют предложения, запрашивают фичи и объясняют юзкейсы, задают и отвечают на вопросы, дают фидбек редакторам спек.

Контент CSS-спецификаций живёт в репозитории [github.com/w3c/csswg-drafts](https://github.com/w3c/csswg-drafts). Там же заводятся ишью и проводятся публичные дикуссии по контенту. Вот, например, [обсуждение](https://github.com/w3c/csswg-drafts/issues/2701) вложенных правил в CSS (nesting).

Также у рабочей группы есть еженедельные собрания, на которых обсуждаются и решаются ишью, ведётся лог обсуждения. Ссылки на лог публикуются в [блог](https://www.w3.org/blog/CSS/) и в [твиттер](https://twitter.com/csswg). Вот, к примеру, о чём договорились на [прошлой неделе](https://www.w3.org/blog/CSS/2021/06/16/minutes-2021-06-16/).

### Спецификации в W3C

Всё спецификации W3C опубликованы тут: [https://www.w3.org/TR/](https://www.w3.org/TR/).

Спеки проходят такие формальные стадии развития **(некоторые промежуточные технические стадии упростил):

1. **Working Draft (WD)** — зафиксированная версия черновика спеки для ревью сообществом.
2. **Candidate Recommendation (CR)** — сигнал для финального ревью сообществом, сбор опыта импелементации спеки в браузерах.
3. **W3C Recommendation (REC)** — все довольны, спека доделана, опубликована финальная версия.

Текущая версия черновика называется **Editor’s Draft (ED)** и может быть «сырой», но она самая «живая» из всех — над ней работает редактор спеки.

### Спецификации по CSS

Если отфильтровать все спеки по тегу CSS, то получится [больше 100 спек](https://www.w3.org/TR/?tag=css).

Большая часть из них — черновики WD, меньшая — рекомендации REC и CR.

После публикации [единой монолитной спецификации CSS 2.1](https://www.w3.org/TR/CSS2/), рабочая группа решила дальше распилить монолитную спеку на отдельные независимые модули.

Появилась идея собрать из отдельных модулей общий сборник «CSS3» и дальше развивать отдельные модули и двигать их по уровням независимо друг от друга.

К примеру, в CSS 2.1 есть раздел про Color. И поэтому в рамках CSS3 появился отдельный модуль — CSS Color Level 3. Дальше он будет двигаться на Level 4, пото на 5 и так далее.

Если в спеке CSS 2.1 изначально какой-то фичи не было, например, кастомных свойств или флексбоксов, то новые спецификации начинают нумероваться с первого уровня: например, CSS Custom Properties for Cascading Variables Module Level 1 или CSS Flexible Box Module Level 1.

Для того, чтобы не потеряться в обилии спек, рабочая группа CSS время от времени публикует «срез» состояния CSS — Snapshot. Последний из опубликованных — [CSS Snapshot 2020](https://www.w3.org/TR/css-2020/). Это список всех спек, по которым в 2020 году можно сказать — это и есть весь современный стабильный CSS.

### Процесс работы над спеками CSS

Как показала практика, работа над CSS-спеками не всегда укладывается в формальную линейную однонаправленную схему WD → CR → REC. Иногда развитие спеки в ответ на полученный фидбек двигается назад, а не вперёд. Поэтому есть более неформальное и близкое к жизни описание стадий работы над спеками, которое показывает *стабильность* спецификации:

1. **Exploring** (ранний WD): нестабильная версия, где всё ещё устаканивается и меняется. Нужен для совместной работы редактора спеки и рабочей группы.
2. **Revising** (средний WD): модуль в основном готов, но спека ещё нуждается в нескольких циклах публикации и ревью. В конце этой стадии рабочая группа фиксирует контент спеки перед переходом на формальный CR.
3. **Refining** (поздний WD): спека уже в основном стабильна и готова для перехода на CR, но ещё нуждается в шлифовке и полировке.
4. **Testing** (ранний CR): на этом этапе рабочая группа уверена, что спека достаточно полна и точна, чтобы её начинать имплементировать и писать тесты, так как дальнейшего развития спеки нужен уже опыт имплементации в браузерах и тест-кейсы.
5. **Stable** (поздний CR): на этой стадии у рабочей группы есть достаточно полученного опыта тестированяи и имплементации спеки, сама спека стабильна и надёжна, минорные ишью появляются нечасто. Такая версия спеки может быть включена в Snapshot.
6. **Completed** (PR, REC): тесты и отчёты об имплементации готовы, изменений больше не предвидится (кроме листинга опечаток).

Все CSS-спеки, сгруппированные по таким стадиям, опубликованы [тут](https://www.w3.org/Style/CSS/current-work).

## WHATWG

Но не W3C единым жива веб-платформа. В 2004 году от W3C откололась группа разработчиков стандартов из-за разногласий по поводу будущего HTML. Эта группа назвалась WHATWG — Web Hypertext Application Technology Working Group. В W3C собирались остановить работу над HTML в угоду XHTML 2, новой версии XHTML, обратно не совместимой с HTML 4 и XHTML 1. В WHATWG считали, что нужно продолжать развивать HTML и поготавливать стандарты для будущего использования HTML при создании веб-приложений. Они форкнули HTML и развили его до того самого HTML5, тем самым выиграв у W3C.

До 2019 существовало две разные параллельные спецификации HTML, но потом W3C и WHATWG помирились и договорились работать вместе над [«вечнозелёной» спекой HTML](https://html.spec.whatwg.org/multipage/).

Помимо HTML в WHATWG работают над такими фичами: Compatibility, Console Object, DOM, Encoding, Fetch, Fullscreen, URL и XHR. Все спецификации опубликованы на сайте [spec.whatwg.org](https://spec.whatwg.org/).

Спеки WHATWG живут в репозитории [github.com/whatwg](https://github.com/whatwg/).

### Процесс работы WHATWG

WHATWG, в отличие от W3C, открытое и бесплатное сообщество. Любой желающий может участвовать в развитии спек. Работа ведётся на [Гитхабе](https://github.com/whatwg/).

Все стандарты WHATWG — «вечнозелёные», то есть не имеют версий, а всегда «доделаны». В WHATWG сравнивают разработку спек с разработкой ПО — софт тоже постоянно разрабатывается и меняется.

У каждого стандарта в идеале есть:

- редактор или несколько;
- активное сообщество контрибьюторов;
- чейнджлог;
- ишью-трекер;
- тесты.

Редактор тащит развитие стандарта, разрешает разногласия между контрибьюторами, сокращает количество открытых ишью, договаривается с имплементаторами стандарта (разработчиками браузеров) и допиливает стандарт под имплементации.

Всего в [организации на Гитхабе](https://github.com/orgs/whatwg/people) в июне 2021 состоит 81 человек.

## Тесты веб-платформы

О тестах мало упоминают, когда рассказывают о веб-спецификациях. То есть вот есть текст спеки, вот её заимплементировали в браузере, это ок. А как узнать, что ничего старого при этом не поломалось? Или, что имплементация корректная, спеку поняли правильно?

Тесты нужны, чтобы помочь мейнтейнерам софта (браузеров) проверить корректность своей работы: найти баги, проблемы совместимости с другими браузерами; также они помогают приоритизировать работу над определённой группой более критичных багов. У веб-платформы есть свой набор тестов, который открыто пишется сообществом: [github.com/web-platform-tests/wpt](https://github.com/web-platform-tests/wpt). Они удобно разделены по названиям фич и внутри структурированы по разделам спецификаций.

Реалии таковы, что браузеры не проходят все тесты на 100%, и, думаю, вряд ли будут когда-то их проходить. Новые фичи появляются в браузерах, а за ними приходят баги, спеки, и имплементации допиливаются — всё это нормально. К примеру, в июне 2021 из 41761 тестов в Chrome не проходят 510 тестов, в Firefox — 1377, а в Safari — 3859.

Вживую графики проходимых тестов, сгруппированные по фичам, есть на сайте [wpt.fyi](https://wpt.fyi/). Вот такая, к примеру, [ситуация с поддержкой гридов в браузерах](https://wpt.fyi/results/css/css-grid?label=experimental&label=master&aligned).

Тесты, помимо пользы разработчикам браузеров, дают и обычным разработчикам возможность оценивать фичи перед использованием. Обычно разработчики смотрят на статистику имплементации фич на сайте [CanIUse](https://caniuse.com/). Так можно получить ответ на вопрос: есть ли фича в опредлённом браузере. Но кроме наличия фичи есть ещё и:

- баги в её реализации: к примеру, гриды поддерживаются всеми вечнозелёными браузерами, но при этом в крайних случаях реализация между браузерами разнится;
- уровень стабильности спеки: то, что фича реализована в браузере не говорит о том, что она не изменится в будущем; если фича основана на нестабильной спеке, то вероятно при уточнении спеки изменится и сама фича.

## Как контрибьютить в веб-платформу

Единственный вариант въехать в тему — подтянуть английский и заняться багами:

- сообщать о багах разработчикам браузеров: [bugzilla.mozilla.org](https://bugzilla.mozilla.org/), [bugs.webkit.org](https://bugs.webkit.org/), [bugs.chromium.org](https://bugs.chromium.org/p/chromium/issues/list);
- решать баги в тестах или писать новые тесты: [github.com/web-platform-tests](https://github.com/web-platform-tests/wpt/issues?q=is%3Aopen+is%3Aissue+label%3A"good+first+issue");
- решать баги в спеках: [WHATWG](https://github.com/whatwg/html/labels/good%20first%20issue), [W3C](https://github.com/w3c/csswg-drafts/issues?q=is%3Aopen+is%3Aissue+label%3A%22Help+Wanted%22).
